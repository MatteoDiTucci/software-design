<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Test doubles - A Compendium of Software Design</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A summary with sources of what contributes to good software design">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/introduction.html"><strong aria-hidden="true">2.</strong> It passes all tests</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../passes-all-tests/test-pyramid.html"><strong aria-hidden="true">2.1.</strong> Test pyramid</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/if-testing-is-hard-inject.html"><strong aria-hidden="true">2.2.</strong> If testing is hard, inject what you need to verify</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/test-doubles.html" class="active"><strong aria-hidden="true">2.3.</strong> Test doubles</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/test-driven-development.html"><strong aria-hidden="true">2.4.</strong> Test driven development</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/test-coverage-is-not-enough.html"><strong aria-hidden="true">2.5.</strong> Test coverage is not enough</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/tests-must-be-reproducible.html"><strong aria-hidden="true">2.6.</strong> Tests must be reproducible</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/no-production-code-constants-in-tests.html"><strong aria-hidden="true">2.7.</strong> No production code constants in tests</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/do-not-test-libraries.html"><strong aria-hidden="true">2.8.</strong> Do not test libraries ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/component-tests-vs-end-to-end-tests-vs-monitoring-tradeoffs.html"><strong aria-hidden="true">2.9.</strong> Component tests vs end-to-end tests vs monitoring tradeoffs ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/expand-and-contract.html"><strong aria-hidden="true">2.10.</strong> Expand and contract ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/contract-testing.html"><strong aria-hidden="true">2.11.</strong> Contract testing ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/performance-tests.html"><strong aria-hidden="true">2.12.</strong> Performance tests ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/how-to-test-ui.html"><strong aria-hidden="true">2.13.</strong> How to test UI ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../passes-all-tests/linting.html"><strong aria-hidden="true">2.14.</strong> Linting ğŸ—ï¸</a></li></ol></li><li class="chapter-item expanded "><a href="../expresses-intent/introduction.html"><strong aria-hidden="true">3.</strong> It expresses intent</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../expresses-intent/naming.html"><strong aria-hidden="true">3.1.</strong> Naming</a></li><li class="chapter-item expanded "><a href="../expresses-intent/deep-and-narrow-classes.html"><strong aria-hidden="true">3.2.</strong> Deep and narrow classes</a></li><li class="chapter-item expanded "><a href="../expresses-intent/immutability.html"><strong aria-hidden="true">3.3.</strong> Immutability</a></li><li class="chapter-item expanded "><a href="../expresses-intent/generalise-edge-cases.html"><strong aria-hidden="true">3.4.</strong> Generalise edge casesï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/small-classes-and-short-methods.html"><strong aria-hidden="true">3.5.</strong> Small classes and short methods ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/liskov-substitution-principle.html"><strong aria-hidden="true">3.6.</strong> Liskov substitution principle ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/usually-composition-is-better-than-inheritance.html"><strong aria-hidden="true">3.7.</strong> Usually composition is better than inheritance ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/test-naming.html"><strong aria-hidden="true">3.8.</strong> Test naming ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/comment-the-why.html"><strong aria-hidden="true">3.9.</strong> Comment the why ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/visual-indentation.html"><strong aria-hidden="true">3.10.</strong> Visual indentation ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/folder-structure.html"><strong aria-hidden="true">3.11.</strong> Folder structure ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/wishful-thinking.html"><strong aria-hidden="true">3.12.</strong> Wishful thinking ğŸ—ï¸</a></li></ol></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/introduction.html"><strong aria-hidden="true">4.</strong> It does not repeat itself</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../does-not-repeat-itself/one-single-authoritative-representation.html"><strong aria-hidden="true">4.1.</strong> One single authoritative knowledge representation</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/do-not-abstract-by-visual-pattern-matching.html"><strong aria-hidden="true">4.2.</strong> Do not abstract by visual pattern matching</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/open-closed-principle.html"><strong aria-hidden="true">4.3.</strong> Open-closed principleï¸</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/dependency-inversion-principle.html"><strong aria-hidden="true">4.4.</strong> Dependency inversion principle</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/information-hiding.html"><strong aria-hidden="true">4.5.</strong> Information hidingï¸</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/wrap-libraries-into-custom-classes.html"><strong aria-hidden="true">4.6.</strong> Wrap libraries into custom classes ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/polymorphism.html"><strong aria-hidden="true">4.7.</strong> Polymorphism ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../expresses-intent/single-responsibility-principle.html"><strong aria-hidden="true">4.8.</strong> Single responsibility principle ğŸ—ï¸</a></li><li class="chapter-item expanded "><a href="../does-not-repeat-itself/interface-segregation-principle.html"><strong aria-hidden="true">4.9.</strong> Interface segregation principle ğŸ—ï¸</a></li></ol></li><li class="chapter-item expanded "><a href="../does-not-contain-superfluous-parts/introduction.html"><strong aria-hidden="true">5.</strong> It does not contain superfluous parts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../does-not-contain-superfluous-parts/you-are-not-going-to-need-it.html"><strong aria-hidden="true">5.1.</strong> Does not contain superfluous parts</a></li><li class="chapter-item expanded "><a href="../does-not-contain-superfluous-parts/clarify-what-is-superfluous.html"><strong aria-hidden="true">5.2.</strong> Clarify what is superfluous</a></li><li class="chapter-item expanded "><a href="../does-not-contain-superfluous-parts/do-not-abuse-design-patterns.html"><strong aria-hidden="true">5.3.</strong> Do not abuse design patterns</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">A Compendium of Software Design</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#test-doubles" id="test-doubles">Test doubles</a></h2>
<p>When testing a class, often we need to create a lot of objects just for the sake of the test. This happens for two reasons:</p>
<ul>
<li>All those objects are needed to make the test run (e.g. they are required by the constructor of the class under test)</li>
<li>We want to verify how the class under test interacts with those objects (e.g. if the class under test calls the public method of another one)</li>
</ul>
<p>Because of the above, tests can become time-consuming and tedious. Fortunately, we can remediate by using test doubles. For the sake
of development speed, test doubles are usually created via testing libraries. For instance, in Kotlin there is
<a href="https://mockk.io/">MockK</a> among others. Taking the following code as example, let's define the different types of test doubles
and how they look like in a test when using a library like MockK.</p>
<pre><code class="language-kotlin">class Greeter(private val validator: Validator) {

  fun greetings(): String {
    return &quot;Hello&quot;
  }

  fun personalisedGreetings(name: String): String {
    if (validator.isValid(name))
      return &quot;Hello $name&quot;
    
    return &quot;Not a valid name&quot;
  }
}

class Validator {

  fun isValid(name: String): Boolean {
    if (name.isEmpty())
      return false
    
    return true
  }
}
</code></pre>
<p><strong>Stubs</strong><br />
They return a hardcoded response. In the following test, <code>validator</code> is a stub. Unfortunately mocks
and stubs in MockK are both defined as <code>mockk&lt;&gt;()</code> which makes it confusing for newcomers.</p>
<pre><code class="language-kotlin">@Test
  fun `greets by name`() {
    val validator = mockk&lt;Validator&gt;()
    every{ validator.isValid(&quot;Andrea&quot;) } returns true
    val controller = Greeter(validator)
  
    val result = controller.personalisedGreetings(&quot;Andrea&quot;)
  
    assertEquals(&quot;Hello Andrea&quot;, result)
  }
</code></pre>
<p><strong>Mocks</strong><br />
They have two responsibilities:</p>
<ul>
<li>they return a hardcoded response</li>
<li>the test checks that their public methods are called with specific input parameters</li>
</ul>
<p>In the following test,
<code>validator</code> is a mock.</p>
<pre><code class="language-kotlin">@Test
  fun `performs successful validation on the name`() {
    val validator = mockk&lt;Validator&gt;()
    every{ validator.isValid(&quot;Andrea&quot;) } returns true
    val controller = Greeter(validator)
  
    controller.personalisedGreetings(&quot;Andrea&quot;)
  
    verify{ validator.isValid(&quot;Andrea&quot;) }
  }
</code></pre>
<p><strong>Spies</strong><br />
The test checks that their public methods are called with specific input parameters. In the
following test, <code>validator</code> is spy.</p>
<pre><code class="language-kotlin">@Test
  fun `performs validation on the name`() {
    val name = &quot;Andrea&quot;
    val validator = spyk&lt;Validator&gt;()
    val controller = Greeter(validator)

    controller.personalisedGreetings(name)

    verify{ validator.isValid(name) }
  }
</code></pre>
<p><strong>Dummies</strong><br />
They are used to run the test but they do not take any part in it, meaning no public method of theirs is called.
For instance, <code>validator</code> in the following test is a dummy as the method <code>greetings</code> does not interact with <code>validator</code>.</p>
<pre><code class="language-kotlin">@Test
  fun `greets by saying Hello`() {
    val validator = mockk&lt;Validator&gt;()
    val controller = Greeter(validator)

    val result = controller.greetings()

    assertEquals(&quot;Hello&quot;, result)
  }
</code></pre>
<p><strong>Fakes</strong><br />
An object with very limited capabilities compared to the real one but much faster to create. The typical example is
an in memory database (e.g. H2) instead of a production one (e.g. PostgreSQL)</p>
<p>As a final note, test doubles are not used just for unit tests, but throughout the <a href="test-pyramid.html">whole testing pyramid</a>.</p>
<br/>
<h4><a class="header" href="#recommended-reads" id="recommended-reads">Recommended reads</a></h4>
<ul>
<li><a href="https://martinfowler.com/articles/mocksArentStubs.html">Mocks aren't stubs - Martin Fowler</a></li>
<li><a href="https://www.goodreads.com/book/show/4268826-growing-object-oriented-software-guided-by-tests">Only mock type that you own, chapter 8 of Growing Object-Oriented Software, Guided by Tests - Steve Freeman, Nat Pryce</a></li>
<li><a href="https://github.com/testdouble/contributing-tests/wiki/Don%27t-mock-what-you-don%27t-own">Don't mock what you don't own, contributing-tests wiki - Justin Searls</a></li>
</ul>
<h4><a class="header" href="#teach-me-back" id="teach-me-back">Teach me back</a></h4>
<p>I really appreciate any <a href="../introduction/introduction.html#teach-me-back">feedback</a> about the book and my current understanding of software design.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../passes-all-tests/if-testing-is-hard-inject.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../passes-all-tests/test-driven-development.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../passes-all-tests/if-testing-is-hard-inject.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../passes-all-tests/test-driven-development.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
